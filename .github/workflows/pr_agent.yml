name: PR Agent

on:
  pull_request:
    types: [opened, reopened, ready_for_review]
  issue_comment:

jobs:
  pr_agent_job:
    if: ${{ github.event.sender.type != 'Bot' }}
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
      contents: write
    name: Run pr agent on every pull request, respond to user comments
    steps:
      - name: PR Agent action step
        id: pragent
        uses: qodo-ai/pr-agent@main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          # ============================================
          # API Key 配置（选择一个，取消注释）
          # ============================================

          # --- 选项 1: OpenAI ---
          # OPENAI_KEY: ${{ secrets.OPENAI_KEY }}

          # --- 选项 2: 智谱 AI（OpenAI兼容API）---
          # 方式1: 使用ZAI_API_KEY（如果LiteLLM原生支持）
          # ZAI_API_KEY: ${{ secrets.ZAI_API_KEY }}

          # 方式2: 使用OPENAI配置（推荐，OpenAI兼容API）
          OPENAI__API_BASE: https://open.bigmodel.cn/api/coding/paas/v4
          OPENAI__KEY: ${{ secrets.ZHIPU_API_KEY }}

          # --- 选项 3: DeepSeek ---
          # DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}

          # --- 选项 4: Gemini (Google AI Studio) ---
          # GOOGLE_AI_STUDIO.GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

          # --- 选项 5: Claude (Anthropic) ---
          # ANTHROPIC.KEY: ${{ secrets.ANTHROPIC_KEY }}

          # ============================================
          # 自动工具配置
          # ============================================
          github_action_config.auto_review: "true"
          github_action_config.auto_describe: "true"
          github_action_config.auto_improve: "true"

          # ============================================
          # 注意：其他配置在 .pr_agent.toml 文件中
          # ============================================
