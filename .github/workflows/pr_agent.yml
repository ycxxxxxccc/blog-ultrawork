name: PR Agent

on:
  pull_request:
    types: [opened, reopened, ready_for_review]
  issue_comment:

jobs:
  pr_agent_job:
    if: ${{ github.event.sender.type != 'Bot' }}
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
      contents: write
    name: Run pr agent on every pull request, respond to user comments
    steps:
      - name: PR Agent action step
        id: pragent
        uses: qodo-ai/pr-agent@main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # ============================================
          # 配置说明
          # ============================================
          #
          # 1. 选择 LLM 提供商（取消注释你想要的配置）
          #
          # 2. 在仓库设置中添加对应的 API Key：
          #    Settings > Secrets and variables > Actions > New repository secret
          #
          # 3. 支持的提供商：
          #    - OpenAI (默认): OPENAI_KEY
          #    - 智谱 AI: ZAI_API_KEY
          #    - DeepSeek: DEEPSEEK_API_KEY
          #    - Gemini: GEMINI_API_KEY
          #    - Claude: ANTHROPIC_KEY
          #
          # ============================================

          # --- 选项 1: OpenAI (默认) ---
          # OPENAI_KEY: ${{ secrets.OPENAI_KEY }}

          # --- 选项 2: 智谱 AI ---
          OPENAI_API_BASE: "https://open.bigmodel.cn/api/coding/paas/v4"
          OPENAI_KEY: "${{ secrets.ZAI_API_KEY }}"
          config.model: "zhipu/glm-4.7"
          config.fallback_models: '["zhipu/glm-4.7"]'

          # --- 选项 3: DeepSeek ---
          # config.model: "deepseek/deepseek-chat"
          # config.fallback_models: '["deepseek/deepseek-chat"]'
          # DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}

          # --- 选项 4: Gemini (Google AI Studio) ---
          # config.model: "gemini/gemini-1.5-flash"
          # config.fallback_models: '["gemini/gemini-1.5-flash"]'
          # GOOGLE_AI_STUDIO.GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

          # --- 选项 5: Claude (Anthropic) ---
          # config.model: "anthropic/claude-3-opus-20240229"
          # config.fallback_models: '["anthropic/claude-3-haiku-20240307"]'
          # ANTHROPIC.KEY: ${{ secrets.ANTHROPIC_KEY }}

          # ============================================
          # 自动工具配置（可修改）
          # ============================================
          # auto_review: 自动运行代码审查
          # auto_describe: 自动生成 PR 描述
          # auto_improve: 自动提供代码改进建议
          github_action_config.auto_review: "true"
          github_action_config.auto_describe: "true"
          github_action_config.auto_improve: "true"
          config.custom_model_max_tokens: 4096
          # ============================================
          # 高级配置（可选）
          # ============================================
          # 自定义审查指令（示例）
          # pr_reviewer.extra_instructions: "关注安全漏洞和代码质量。检查适当的错误处理。"

          # 代码建议数量
          # pr_code_suggestions.num_code_suggestions: "6"

          # 响应语言（可选值: "en-US", "zh-CN" 等）
          # config.response_language: "zh-CN"
