name: PR Agent Review
on:
  pull_request:
    types: [opened, reopened, synchronize]

permissions:
  pull-requests: write
  contents: read

jobs:
  pr_agent_job:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: PR Agent - Review
        id: pragent-review
        uses: qodo-ai/pr-agent@main
        env:
          # 智谱AI API配置
          OPENAI__KEY: ${{ secrets.ZAI_API_KEY }}
          # 使用智谱AI通过LiteLLM代理
          CONFIG__MODEL: "zai/glm-4.5-flash"
          CONFIG__GIT_PROVIDER: "github"
          # GitHub Token (自动提供)
          GITHUB__TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: PR Agent - Improve (Manual)
        if: github.event.comment == '/improve'
        uses: qodo-ai/pr-agent@main
        env:
          OPENAI__KEY: ${{ secrets.ZAI_API_KEY }}
          CONFIG__MODEL: "zai/glm-4.5-flash"
          CONFIG__GIT_PROVIDER: "github"
          GITHUB__TOKEN: ${{ secrets.GITHUB_TOKEN }}
